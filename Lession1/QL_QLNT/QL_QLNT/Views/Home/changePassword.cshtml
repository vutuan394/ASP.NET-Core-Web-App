﻿
    @{
        ViewBag.Title = "Đổi Mật Khẩu";
        Layout = "~/Views/Shared/_Layout.cshtml";
        string errorMessage = ViewBag.ErrorMessage;
    }

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white text-center">
                        <h2 class="mb-0">ĐỔI MẬT KHẨU</h2>
                    </div>
                    <div class="card-body">
                        <form id="changePasswordForm" action="@Url.Action("changePassword", "Home", new { id = ViewBag.Ma })" method="post">
                            <div class="mb-3">
                                <label for="MatkhauCu" class="form-label">Mật khẩu cũ:</label>
                                <input type="password" class="form-control" id="MatkhauCu" name="MatkhauCu" required>
                            </div>
                            <div class="mb-3">
                                <label for="MatKhauMoi" class="form-label">Mật khẩu mới:</label>
                                <input type="password" class="form-control" id="MatKhauMoi" name="MatKhauMoi" required
                                       minlength="6" pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$"
                                       title="Mật khẩu phải có ít nhất 6 ký tự, bao gồm chữ hoa, chữ thường và số">
                            </div>
                            <div class="mb-3">
                                <label for="ReMatKhauMoi" class="form-label">Nhập lại mật khẩu mới:</label>
                                <input type="password" class="form-control" id="ReMatKhauMoi" name="ReMatKhauMoi" required>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary">Lưu Thay Đổi</button>
                            </div>
                        </form>

                        @if (!string.IsNullOrEmpty(errorMessage))
                        {
                            <div id="errorMessage" class="alert alert-danger mt-3" role="alert">
                                @errorMessage
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    @section Scripts {
        <script>
            $(document).ready(function () {
                // Xác thực mật khẩu mới và nhập lại mật khẩu
                $('#changePasswordForm').on('submit', function (e) {
                    const newPassword = $('#MatKhauMoi').val();
                    const confirmPassword = $('#ReMatKhauMoi').val();

                    if (newPassword !== confirmPassword) {
                        e.preventDefault();
                        alert('Mật khẩu mới và nhập lại mật khẩu không khớp!');
                        $('#ReMatKhauMoi').focus();
                    }
                });

                // Ẩn thông báo lỗi sau 5 giây
                setTimeout(function () {
                    $('#errorMessage').fadeOut();
                }, 5000);
            });
        </script>
    }